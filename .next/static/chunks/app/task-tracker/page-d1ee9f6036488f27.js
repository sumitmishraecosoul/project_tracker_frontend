(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[819],{883:(e,t,s)=>{"use strict";s.d(t,{fn:()=>n,gg:()=>l,lk:()=>r,lx:()=>i,uy:()=>a});let a=["Supply Chain-Operations","Human Resources and Administration","New Product Design","India E-commerce","Supply Chain","Data Analytics","E-commerce","Retail E-commerce","Finance & Accounts","Zonal Sales (India)- HORECA","Zonal Sales (India)","Supply Chain & Operation","Zonal Sales","Digital Marketing"],r="India E-commerce",l=["admin","manager","employee"],i="employee",n={admin:"Administrator",manager:"Manager",employee:"Employee"}},5802:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var a=s(5155),r=s(2115),l=s(5695);function i(e){let{children:t}=e,[s,i]=(0,r.useState)(!1),[n,o]=(0,r.useState)(!0),d=(0,l.useRouter)();return((0,r.useEffect)(()=>{console.log("ProtectedRoute: Checking authentication...");let e=localStorage.getItem("currentUser"),t=localStorage.getItem("token");if(console.log("ProtectedRoute: User exists:",!!e),console.log("ProtectedRoute: Token exists:",!!t),e&&t)console.log("ProtectedRoute: User authenticated, setting state..."),i(!0);else{console.log("ProtectedRoute: No user or token, redirecting to login..."),d.push("/login");return}o(!1)},[d]),n)?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("i",{className:"ri-loader-4-line animate-spin text-2xl text-blue-600"}),(0,a.jsx)("span",{className:"text-gray-600",children:"Loading..."})]})}):s?(0,a.jsx)(a.Fragment,{children:t}):null}},8258:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>x});var a=s(5155),r=s(2115),l=s(7288),i=s(9265),n=s(5731),o=s(5802),d=s(7296),c=s(883);function x(){let[e,t]=(0,r.useState)([]),[s,x]=(0,r.useState)([]),[p,m]=(0,r.useState)(""),[u,g]=(0,r.useState)("All Tasks"),[h,y]=(0,r.useState)("All"),[f,j]=(0,r.useState)({}),[k,b]=(0,r.useState)([]),[N,w]=(0,r.useState)("All Projects"),[v,A]=(0,r.useState)("All Departments"),[T,S]=(0,r.useState)([]),[D,_]=(0,r.useState)(!1),[C,P]=(0,r.useState)(!1),[I,E]=(0,r.useState)(null),[F,H]=(0,r.useState)(!1),[R,M]=(0,r.useState)(""),[O,U]=(0,r.useState)(null);(0,r.useEffect)(()=>{B();let e=localStorage.getItem("currentUser");if(e){let t=JSON.parse(e);U(t),"admin"===t.role&&(t.department?A(t.department):A("All Departments"))}},[]);let K=async()=>{try{if((null==O?void 0:O.role)==="admin"){let e=await d.K.getDepartments();S(e)}}catch(e){console.error("Error fetching departments:",e)}};(0,r.useEffect)(()=>{O&&K()},[O]),(0,r.useEffect)(()=>{O&&(B(),w("All Projects"))},[O,v]),(0,r.useEffect)(()=>{p&&L()},[p,u,h,N,v]),(0,r.useEffect)(()=>{let e=async()=>{try{let e={};(null==O?void 0:O.role)==="admin"&&(e.department=v);let t=await d.K.getProjects(e),s=Array.isArray(t)?t:t&&Array.isArray(t.projects)?t.projects:[],a={};(s||[]).forEach(e=>{e&&(e._id||e.id)&&(a[e._id||e.id]=e.title)}),j(a);let r=(s||[]).map(e=>({id:e._id||e.id,title:e.title}));b(r)}catch(e){}};O&&e()},[O,v]);let B=async()=>{try{let e=localStorage.getItem("currentUser"),s=e?JSON.parse(e):null,a=[];if((null==s?void 0:s.role)==="admin"){if("All Departments"===v){let e=await d.K.getUsers();a=Array.isArray(e)?e:[]}else{let e=await d.K.getUsers();a=Array.isArray(e)?e.filter(e=>e.department===v):[]}t(a)}else{let e=await d.K.getMyTeam();a=Array.isArray(e)?e:[],t(a)}a.length>0&&!p&&a[0]._id&&m(a[0]._id)}catch(e){console.error("Failed to fetch users:",e),M("Failed to load users")}},L=async()=>{if(console.log("=== fetchTasks called ==="),!p)return void console.log("No activeUserId, returning early");console.log("Fetching tasks for user ID:",p),H(!0);try{let e;console.log("Calling apiService.getTasks()..."),"Adhoc Tasks"===u?e="Adhoc":"Daily Tasks"===u?e="Daily":"Weekly Tasks"===u?e="Weekly":"Monthly Tasks"===u&&(e="Monthly");let t={assignedTo:p,taskType:e,status:"All"===h?"":h,projectId:N&&"All Projects"!==N?N:void 0};(null==O?void 0:O.role)==="admin"&&(t.department=v);let s=await d.K.getTasks(t);if(console.log("All tasks fetched from API:",s),console.log("Tasks data type:",typeof s),console.log("Tasks is array:",Array.isArray(s)),!Array.isArray(s)){console.error("API response is not an array:",s),x([]),H(!1);return}console.log("Number of tasks fetched:",s.length),s.length>0?(console.log("Sample task structure:",s[0]),console.log("Sample task assignedTo field:",s[0].assignedTo),console.log("Sample task _id field:",s[0]._id),console.log("Sample task id field:",s[0].id)):console.log("No tasks found in API response");let a=s;N&&"All Projects"!==N&&(a=s.filter(e=>e.projectId===N)),a=a.filter(e=>e.assignedTo&&"object"==typeof e.assignedTo&&e.assignedTo._id?e.assignedTo._id===p:!!e.assignedTo&&"string"==typeof e.assignedTo&&e.assignedTo===p),console.log("Tasks from API (RBAC filtered):",a),console.log("Active user:",W),x(a)}catch(e){console.error("Failed to fetch tasks:",e),M("Failed to load tasks")}H(!1)},W=e.find(e=>e._id===p),Z=Array.isArray(s)?s:[];console.log("=== Task Display Debug ==="),console.log("Active user:",W),console.log("All tasks for user:",s),console.log("Active task tab:",u),console.log("Filtered tasks:",Z),console.log("Tasks array length:",s.length),console.log("Filtered tasks length:",Z.length);let J=async e=>{try{console.log("Task created successfully:",e),await L(),_(!1)}catch(e){console.error("Failed to add task:",e),M("Failed to add task")}},Y=e=>!!O&&("admin"===O.role||"manager"===O.role||"employee"===O.role&&(e.assignedTo._id===O._id||e.reporter._id===O._id)),q=e=>!!O&&("admin"===O.role||"manager"===O.role||(O.role,!1)),z=async e=>{if(confirm("Are you sure you want to delete this task?"))try{await d.K.deleteTask(e),await L()}catch(e){console.error("Failed to delete task:",e),M("Failed to delete task")}},G=e=>{console.log("Edit task clicked:",e),E(e),P(!0)};return(0,a.jsx)(o.A,{children:(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(l.A,{}),(0,a.jsx)("div",{className:"px-6 py-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-8 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Task Tracker"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Manage individual tasks and track progress"}),O&&(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Role: ",O.role," â€¢ Department: ",O.department]}),(null==O?void 0:O.role)==="admin"&&"All Departments"!==v&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800",children:[(0,a.jsx)("i",{className:"ri-filter-line mr-1"}),"Filtered by: ",v]})})]}),!!O&&(0,a.jsxs)("button",{onClick:()=>_(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium cursor-pointer whitespace-nowrap flex items-center space-x-2",children:[(0,a.jsx)("i",{className:"ri-add-line w-5 h-5"}),(0,a.jsx)("span",{children:"Add New Task"})]})]}),R&&(0,a.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:R}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Team Members"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:Array.isArray(e)&&e.map((e,t)=>(0,a.jsx)("button",{onClick:()=>e._id&&m(e._id),className:"px-4 py-2 rounded-full text-sm font-medium cursor-pointer whitespace-nowrap transition-colors ".concat(p===e._id?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.name},e._id||"user-".concat(t)))})]}),W&&(0,a.jsx)("div",{className:"p-6 border-b border-gray-200 bg-gray-50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:W.name}),(0,a.jsx)("p",{className:"text-gray-600",children:W.role}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:W.email})]}),(0,a.jsxs)("button",{onClick:()=>_(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 cursor-pointer whitespace-nowrap flex items-center",children:[(0,a.jsx)("i",{className:"ri-add-line w-4 h-4 mr-2"}),"Add New Task"]})]})}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("div",{className:"flex space-x-1 bg-gray-100 rounded-full p-1 w-fit",children:["All Tasks","Daily Tasks","Weekly Tasks","Monthly Tasks","Adhoc Tasks"].map(e=>(0,a.jsx)("button",{onClick:()=>g(e),className:"px-4 py-2 rounded-full text-sm font-medium cursor-pointer whitespace-nowrap transition-colors ".concat(u===e?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:e},e))}),(0,a.jsxs)("div",{className:"flex items-end gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1 text-right",children:"Project"}),(0,a.jsxs)("select",{value:N,onChange:e=>w(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm min-w-[200px]",children:[(0,a.jsx)("option",{value:"All Projects",children:"All Projects"}),k.map(e=>(0,a.jsx)("option",{value:e.id,children:e.title},e.id))]})]}),(null==O?void 0:O.role)==="admin"&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1 text-right",children:"Department"}),(0,a.jsxs)("select",{value:v,onChange:e=>A(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm min-w-[200px]",children:[(0,a.jsx)("option",{value:"All Departments",children:"All Departments"}),(T.length>0?T:c.uy).map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1 text-right",children:"Status"}),(0,a.jsxs)("select",{value:h,onChange:e=>y(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm",children:[(0,a.jsx)("option",{children:"All"}),(0,a.jsx)("option",{children:"Yet to Start"}),(0,a.jsx)("option",{children:"In Progress"}),(0,a.jsx)("option",{children:"Completed"}),(0,a.jsx)("option",{children:"Blocked"}),(0,a.jsx)("option",{children:"On Hold"}),(0,a.jsx)("option",{children:"Cancelled"})]})]})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Task ID"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Task"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Project"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Priority"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reporter"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Start Date"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"End Date"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Hours"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:F?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:13,className:"px-6 py-8 text-center text-gray-500",children:"Loading tasks..."})}):Array.isArray(Z)&&Z.length>0?Z.map((e,t)=>{var s;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.id}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.task}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:f[e.projectId]||e.projectId}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900 max-w-xs truncate",children:e.description}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("Daily"===e.taskType?"bg-blue-100 text-blue-800":"Weekly"===e.taskType?"bg-purple-100 text-purple-800":"Monthly"===e.taskType?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.taskType})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("Completed"===e.status?"bg-green-100 text-green-800":"In Progress"===e.status?"bg-yellow-100 text-yellow-800":"Blocked"===e.status?"bg-red-100 text-red-800":"On Hold"===e.status?"bg-orange-100 text-orange-800":"Cancelled"===e.status?"bg-gray-200 text-gray-800":"bg-gray-100 text-gray-800"),children:e.status})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("Critical"===e.priority?"bg-red-100 text-red-800":"High"===e.priority?"bg-orange-100 text-orange-800":"Medium"===e.priority?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.priority})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(null==(s=e.reporter)?void 0:s.name)||"Unknown"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.startDate?new Date(e.startDate).toLocaleDateString():"Not set"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(e.eta).toLocaleDateString()}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.actualHours||0,"/",e.estimatedHours||0]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,a.jsxs)("div",{className:"flex space-x-3",children:[Y(e)&&(0,a.jsxs)("button",{onClick:()=>G(e),className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200 shadow-sm",title:"Edit Task",children:[(0,a.jsx)("i",{className:"ri-edit-line w-3 h-3 mr-1"}),"Edit"]}),q(e)&&(0,a.jsxs)("button",{onClick:()=>z(e._id),className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200 shadow-sm",title:"Delete Task",children:[(0,a.jsx)("i",{className:"ri-delete-bin-line w-3 h-3 mr-1"}),"Delete"]})]})})]},e._id||"task-".concat(t))}):(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:13,className:"px-6 py-8 text-center text-gray-500",children:Array.isArray(Z)?"No ".concat(u," found for this user."):"No tasks available."})})})]})})]})]})]})}),D&&(0,a.jsx)(i.A,{userId:p,onAdd:J,onClose:()=>_(!1)}),C&&I&&(0,a.jsx)(n.A,{task:I,onSave:e=>{(async()=>{try{console.log("Saving updated task:",e);let t={task:e.task,description:e.description,taskType:e.taskType,status:e.status,priority:e.priority,assignedTo:e.assignedTo._id,reporter:e.reporter._id,startDate:e.startDate,eta:e.eta,estimatedHours:e.estimatedHours,actualHours:e.actualHours,remark:e.remark,roadBlock:e.roadBlock,supportNeeded:e.supportNeeded,labels:e.labels,attachments:e.attachments,relatedTasks:e.relatedTasks,parentTask:e.parentTask,sprint:e.sprint};console.log("Task data for API:",t),await d.K.updateTask(e._id,t),console.log("Task updated successfully"),P(!1),E(null),await L()}catch(e){console.error("Failed to update task:",e),M("Failed to update task")}})()},onClose:()=>{P(!1),E(null)}})]})})}},8951:(e,t,s)=>{Promise.resolve().then(s.bind(s,8258))}},e=>{var t=t=>e(e.s=t);e.O(0,[244,296,990,441,684,358],()=>t(8951)),_N_E=e.O()}]);