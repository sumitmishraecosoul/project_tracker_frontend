(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[661],{883:(e,t,r)=>{"use strict";r.d(t,{fn:()=>i,gg:()=>l,lk:()=>a,lx:()=>n,uy:()=>s});let s=["Supply Chain-Operations","Human Resources and Administration","New Product Design","India E-commerce","Supply Chain","Data Analytics","E-commerce","Retail E-commerce","Finance & Accounts","Zonal Sales (India)- HORECA","Zonal Sales (India)","Supply Chain & Operation","Zonal Sales","Digital Marketing"],a="India E-commerce",l=["admin","manager","employee"],n="employee",i={admin:"Administrator",manager:"Manager",employee:"Employee"}},3771:(e,t,r)=>{Promise.resolve().then(r.bind(r,6561))},5802:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(5155),a=r(2115),l=r(5695);function n(e){let{children:t}=e,[r,n]=(0,a.useState)(!1),[i,o]=(0,a.useState)(!0),d=(0,l.useRouter)();return((0,a.useEffect)(()=>{console.log("ProtectedRoute: Checking authentication...");let e=localStorage.getItem("currentUser"),t=localStorage.getItem("token");if(console.log("ProtectedRoute: User exists:",!!e),console.log("ProtectedRoute: Token exists:",!!t),e&&t)console.log("ProtectedRoute: User authenticated, setting state..."),n(!0);else{console.log("ProtectedRoute: No user or token, redirecting to login..."),d.push("/login");return}o(!1)},[d]),i)?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("i",{className:"ri-loader-4-line animate-spin text-2xl text-blue-600"}),(0,s.jsx)("span",{className:"text-gray-600",children:"Loading..."})]})}):r?(0,s.jsx)(s.Fragment,{children:t}):null}},6561:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>j});var s=r(5155),a=r(2115),l=r(6874),n=r.n(l),i=r(7288);let o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=(e,t,r)=>Math.max(t,Math.min(r,e));function c(e){let{projects:t,tasks:r}=e,[l,n]=(0,a.useState)("day"),[i,c]=(0,a.useState)(null),m=(0,a.useMemo)(()=>{let e={};return(r||[]).forEach(t=>{let r=t.projectId;r&&(e[r]||(e[r]=[]),e[r].push(t))}),e},[r]),x=e=>{if(!e)return;let t=new Date(e);return isNaN(t.getTime())?void 0:t},u=(0,a.useMemo)(()=>{try{let e=new Date(2025,7,8),s=new Date(e);t.forEach(e=>{let t=x(e.dueDate);t&&t>s&&(s=t)}),(r||[]).forEach(e=>{let t=x(e.eta);t&&t>s&&(s=t)});let a=new Date(e);return a.setDate(e.getDate()+91-1),s<a&&(s=a),{start:e,end:s}}catch(e){return console.error("Error calculating range:",e),{start:new Date(2025,7,8),end:new Date(2025,10,30)}}},[t,r]),h=(0,a.useMemo)(()=>{try{let e=[],t=new Date(u.start);for(;t<=u.end&&e.length<370;)e.push(new Date(t)),t.setDate(t.getDate()+1);return e}catch(e){return console.error("Error calculating days:",e),[]}},[u]),g=e=>{try{let t=x(e);if(!t)return 0;let r=Math.floor((t.getTime()-u.start.getTime())/864e5);return Math.max(0,Math.min(h.length-1,r))}catch(e){return console.error("Error calculating dayIndex:",e),0}},p=(0,a.useMemo)(()=>{try{let e=[],t=new Date(u.start.getFullYear(),u.start.getMonth(),1),r=new Date(u.end.getFullYear(),u.end.getMonth(),1),s=t;for(;s<=r&&e.length<60;)e.push(new Date(s)),s=new Date(s.getFullYear(),s.getMonth()+1,1);return e}catch(e){return console.error("Error calculating months:",e),[]}},[u]),b=e=>{try{let t=x(e);if(!t)return 0;let r=new Date(t.getFullYear(),t.getMonth(),1),s=p.findIndex(e=>e.getFullYear()===r.getFullYear()&&e.getMonth()===r.getMonth());if(-1===s)return t<u.start?0:p.length-1;return s}catch(e){return console.error("Error calculating monthIndexFromDate:",e),0}},j="day"===l?h:p,y=e=>"".concat(d(e,0,j.length)/j.length*100,"%"),f=e=>"day"===l?g(e):b(e),v=(e,t)=>{try{if("day"===l){let r=g(e)+1;return Math.max(null!=t?t:0,Math.min(r,h.length-1))}let r=b(e)+1;return Math.max(null!=t?t:0,Math.min(r,p.length-1))}catch(e){return console.error("Error calculating indexFromDateEnd:",e),null!=t?t:0}},N=new Date(2025,7,20),w=Math.floor((N.getTime()-u.start.getTime())/864e5),D=p.findIndex(e=>e.getFullYear()===N.getFullYear()&&e.getMonth()===N.getMonth()),k=new Date(N.getFullYear(),N.getMonth()+1,0).getDate(),S=N.getDate()/k,C="day"===l?w+.5:(D<0?N<u.start?0:p.length:D)+S,A=y(C),T=(0,a.useMemo)(()=>{if("day"!==l)return[];let e=[],t=["#2dd4bf","#60a5fa","#fb923c","#a78bfa"];u.start;let r=0,s=1;for(;r<h.length;){let a=Math.min(h.length,r+7);e.push({label:"Week ".concat(s),start:r,end:a,color:t[(s-1)%t.length]}),r=a,s++}return e},[h,l,u.start]),[M,P]=(0,a.useState)({});(0,a.useEffect)(()=>{let e=t[0];e&&P(t=>({...t,[e._id||e.id]:!0}))},[t]);let _=e=>P(t=>({...t,[e]:!t[e]}));return j.length?(console.log("Gantt Debug:",{rangeStart:u.start.toLocaleDateString(),rangeEnd:u.end.toLocaleDateString(),daysLength:h.length,projects:t.map(e=>({title:e.title,start:e.startDate,startDate:new Date(e.startDate).toLocaleDateString(),dayIndex:g(e.startDate)}))}),(0,s.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,s.jsxs)("div",{className:"px-6 py-3 border-b border-gray-200 flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-lg font-semibold text-gray-900",children:"Gantt Chart"}),(0,s.jsxs)("div",{className:"flex items-center gap-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 text-xs text-gray-700",children:[(0,s.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,s.jsx)("span",{className:"w-3 h-3 rounded bg-green-500"})," Completed (till today)"]}),(0,s.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,s.jsx)("span",{className:"w-3 h-3 rounded bg-gray-300"})," Remaining"]})]}),(0,s.jsx)("div",{className:"flex items-center bg-gray-100 rounded-full p-1",children:["day","month"].map(e=>(0,s.jsx)("button",{onClick:()=>n(e),className:"px-3 py-1 text-sm rounded-full transition-colors ".concat(l===e?"bg-white shadow-sm text-gray-900":"text-gray-600 hover:text-gray-900"),children:"day"===e?"Day":"Month"},e))})]})]}),(0,s.jsxs)("div",{className:"relative overflow-x-auto",children:[(0,s.jsx)("div",{className:"sticky top-0 z-10 bg-white/85 backdrop-blur supports-[backdrop-filter]:bg-white/70",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("div",{className:"grid text-[10px] font-semibold text-white",style:{gridTemplateColumns:"280px repeat(".concat(j.length,", minmax(36px, 1fr))")},children:[(0,s.jsx)("div",{className:"py-1 pl-6 bg-white"}),j.map((e,t)=>(0,s.jsx)("div",{className:"py-1 bg-white"},"placeholder-".concat(t))),"day"===l&&T.map((e,t)=>(0,s.jsxs)("div",{className:"absolute top-0 left-0 h-6 flex items-center justify-center rounded-md text-[10px] cursor-pointer hover:opacity-90",style:{marginLeft:"280px",left:"calc(".concat(y(e.start),")"),width:"calc(".concat(y(e.end)," - ").concat(y(e.start),")"),backgroundColor:e.color},onMouseEnter:()=>{let r=h[e.start],s=h[Math.max(e.start,e.end-1)];c({label:"Week ".concat(t+1),start:r,end:s,left:"calc(280px + ".concat(y(e.start),")"),width:"calc(".concat(y(e.end)," - ").concat(y(e.start),")")})},onMouseLeave:()=>c(null),children:["Week ",t+1]},"week-".concat(t)))]}),"day"===l?(0,s.jsxs)("div",{className:"grid text-[10px] font-medium text-gray-700 border-b border-gray-200",style:{gridTemplateColumns:"280px repeat(".concat(j.length,", minmax(36px, 1fr))")},children:[(0,s.jsx)("div",{className:"py-2 pl-6 bg-white",children:"Project / Task"}),h.map((e,t)=>(0,s.jsx)("div",{className:"py-2 text-center",children:["S","M","T","W","T","F","S"][e.getDay()]},"d-".concat(t)))]}):(0,s.jsxs)("div",{className:"grid text-[10px] font-medium text-gray-700 border-b border-gray-200",style:{gridTemplateColumns:"280px repeat(".concat(j.length,", minmax(60px, 1fr))")},children:[(0,s.jsx)("div",{className:"py-2 pl-6 bg-white",children:"Project / Task"}),p.map((e,t)=>(0,s.jsxs)("div",{className:"py-2 text-center",children:[o[e.getMonth()]," ",e.getFullYear()]},"m-".concat(t)))]})]})}),(0,s.jsx)("div",{className:"pointer-events-none absolute inset-0 z-30",children:(0,s.jsx)("div",{className:"absolute top-0 bottom-0 border-r-2 border-sky-600",style:{left:"calc(280px + ".concat(A,")")}})}),(0,s.jsx)("div",{className:"pointer-events-none absolute z-40",style:{left:"calc(280px + ".concat(A,")"),top:24},children:(0,s.jsx)("div",{className:"translate-x-[-50%] text-[10px] bg-sky-600 text-white px-2 py-0.5 rounded-sm shadow",children:"Today"})}),i&&(0,s.jsxs)("div",{className:"absolute z-20 mt-1 text-[11px] bg-white border border-gray-200 rounded-md shadow px-2 py-1",style:{left:i.left,top:28},onMouseLeave:()=>c(null),children:[(0,s.jsx)("div",{className:"font-semibold mb-0.5",children:i.label}),(0,s.jsxs)("div",{className:"text-gray-600",children:[i.start.toLocaleDateString()," – ",i.end.toLocaleDateString()]})]}),(0,s.jsx)("div",{className:"divide-y divide-gray-100",children:t.map(e=>{let t=e._id||e.id,r=m[t]||[];return(0,s.jsxs)("div",{className:"px-6 py-4",children:[(0,s.jsxs)("div",{className:"grid items-center",style:{gridTemplateColumns:"280px repeat(".concat(j.length,", minmax(36px, 1fr))")},children:[(0,s.jsxs)("div",{className:"pr-3",children:[(0,s.jsxs)("button",{onClick:()=>_(t),className:"flex items-center gap-2 text-left",children:[(0,s.jsx)("span",{className:"transition-transform ".concat(M[t]?"rotate-90":""),children:"▶"}),(0,s.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:e.title})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[new Date(e.startDate).toLocaleDateString()," – ",new Date(e.dueDate).toLocaleDateString()]})]}),(0,s.jsx)("div",{className:"relative",style:{gridColumn:"2 / -1"},children:(0,s.jsx)("div",{className:"gantt-timeline h-6",children:(()=>{try{let t=f(e.startDate),r=v(e.dueDate,t),a=d(C,t,r),l=new Date(e.startDate).toLocaleDateString(),n=new Date(e.dueDate).toLocaleDateString(),i="".concat(e.title,": ").concat(l," – ").concat(n),o=[];return a>t&&o.push({left:y(t),width:"calc(".concat(y(a)," - ").concat(y(t),")"),cls:"bg-green-500",title:i}),r>a&&o.push({left:y(a),width:"calc(".concat(y(r)," - ").concat(y(a),")"),cls:"bg-gray-300",title:i}),o.map((e,t)=>(0,s.jsx)("div",{title:e.title,className:"absolute top-1/2 -translate-y-1/2 rounded-sm shadow-sm ".concat(e.cls),style:{left:e.left,width:e.width,height:"8px"}},t))}catch(e){return console.error("Error rendering project bar:",e),null}})()})})]}),(0,s.jsx)("div",{className:"mt-3 overflow-hidden transition-all duration-300 ".concat(M[t]?"max-h-[800px] opacity-100":"max-h-0 opacity-0"),children:(0,s.jsxs)("div",{className:"space-y-2",children:[r.map(t=>{let r=f(t.startDate||e.startDate),a=v(t.eta,r);return(0,s.jsxs)("div",{className:"grid items-center",style:{gridTemplateColumns:"280px repeat(".concat(j.length,", minmax(36px, 1fr))")},children:[(0,s.jsx)("div",{className:"pl-4 pr-3",children:(0,s.jsx)("div",{className:"text-xs text-gray-700",children:t.task})}),(0,s.jsx)("div",{className:"relative",style:{gridColumn:"2 / -1"},children:(0,s.jsx)("div",{className:"gantt-timeline h-6",children:(()=>{try{let e=d(C,r,a),l=[];return e>r&&l.push({left:y(r),width:"calc(".concat(y(e)," - ").concat(y(r),")"),cls:"bg-green-500"}),a>e&&l.push({left:y(e),width:"calc(".concat(y(a)," - ").concat(y(e),")"),cls:"bg-gray-300"}),l.map((e,r)=>(0,s.jsx)("div",{title:"".concat(t.task,": ").concat(t.startDate?new Date(t.startDate).toLocaleDateString():""," – ").concat(new Date(t.eta).toLocaleDateString()," (").concat(t.status,")"),className:"absolute top-1/2 -translate-y-1/2 rounded-sm shadow-sm hover:shadow ".concat(e.cls),style:{left:e.left,width:e.width,height:"6px"}},r))}catch(e){return console.error("Error rendering task bar:",e),null}})()})})]},t._id)}),0===r.length&&(0,s.jsx)("div",{className:"pl-4 text-xs text-gray-400",children:"No tasks"})]})})]},t)})})]})]})):(0,s.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:"Loading Gantt chart..."})}var m=r(7296);function x(e){let{onSave:t,onClose:r}=e,[l,n]=(0,a.useState)({title:"",description:"",status:"Active",priority:"Medium",startDate:new Date().toISOString().split("T")[0],dueDate:"",assignedTo:[]}),[i,o]=(0,a.useState)([]),[d,c]=(0,a.useState)(!1),[x,u]=(0,a.useState)(null),[h,g]=(0,a.useState)("");(0,a.useEffect)(()=>{p();let e=localStorage.getItem("currentUser");e&&u(JSON.parse(e))},[]);let p=async()=>{try{let e=await m.K.getAssignableUsers(),t=Array.isArray(e)?e:[];o(t)}catch(e){console.error("Failed to fetch users:",e)}},b=(e,t)=>{n(r=>({...r,[e]:t}))},j=e=>{n(t=>({...t,assignedTo:t.assignedTo.includes(e)?t.assignedTo.filter(t=>t!==e):[...t.assignedTo,e]}))},{sameDepartment:y,differentDepartment:f}=(()=>{if(!x)return{sameDepartment:[],differentDepartment:[]};let e=i.filter(e=>e.name.toLowerCase().includes(h.toLowerCase())||e.email.toLowerCase().includes(h.toLowerCase())||e.department.toLowerCase().includes(h.toLowerCase()));return{sameDepartment:e.filter(e=>e.department===x.department),differentDepartment:e.filter(e=>e.department!==x.department)}})();return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-7xl w-full max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Add New Project"}),(0,s.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 cursor-pointer",children:(0,s.jsx)("i",{className:"ri-close-line w-6 h-6"})})]})}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),c(!0);let r=l.assignedTo.map(e=>({user:e,role:"employee"}));t({...l,startDate:l.startDate,dueDate:l.dueDate,assignedTo:l.assignedTo,teamMembers:r}),c(!1)},className:"p-6",children:[(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project Title"}),(0,s.jsx)("input",{type:"text",value:l.title,onChange:e=>b("title",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,s.jsx)("textarea",{value:l.description,onChange:e=>b("description",e.target.value),rows:4,maxLength:500,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",required:!0})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,s.jsxs)("select",{value:l.status,onChange:e=>b("status",e.target.value),className:"w-full px-3 py-2 pr-8 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,s.jsx)("option",{value:"Active",children:"Active"}),(0,s.jsx)("option",{value:"On Hold",children:"On Hold"}),(0,s.jsx)("option",{value:"Completed",children:"Completed"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),(0,s.jsxs)("select",{value:l.priority,onChange:e=>b("priority",e.target.value),className:"w-full px-3 py-2 pr-8 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,s.jsx)("option",{value:"Low",children:"Low"}),(0,s.jsx)("option",{value:"Medium",children:"Medium"}),(0,s.jsx)("option",{value:"High",children:"High"})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),(0,s.jsx)("input",{type:"date",value:l.startDate,onChange:e=>b("startDate",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Due Date"}),(0,s.jsx)("input",{type:"date",value:l.dueDate,onChange:e=>b("dueDate",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign Team Members"}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Current Project Team Members"}),0===l.assignedTo.length?(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:"No team members assigned to this project"}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:l.assignedTo.map(e=>{let t=i.find(t=>t._id===e);return t?(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:t.name}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:t.email}),(0,s.jsx)("div",{className:"text-xs text-gray-400",children:t.department})]}),(0,s.jsx)("button",{onClick:()=>j(e),disabled:d,className:"text-red-600 hover:text-red-800 text-sm font-medium disabled:opacity-50 p-1 hover:bg-red-50 rounded ml-2",title:"Remove team member",children:(0,s.jsx)("i",{className:"ri-close-line w-4 h-4"})})]},e):null})})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Team Members"}),(0,s.jsx)("input",{type:"text",value:h,onChange:e=>g(e.target.value),placeholder:"Search by name, email, or department...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["My Team Members (",y.length,")",(0,s.jsx)("span",{className:"text-sm text-gray-500 ml-2",children:"• Same Department"})]}),0===y.length?(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:"No available team members from your department"}):(0,s.jsx)("div",{className:"max-h-60 overflow-y-auto border border-gray-300 rounded-md p-3",children:y.map(e=>(0,s.jsxs)("label",{className:"flex items-center space-x-3 py-2 cursor-pointer hover:bg-gray-50 rounded px-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:l.assignedTo.includes(e._id),onChange:()=>j(e._id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.email}),(0,s.jsxs)("div",{className:"text-xs text-gray-400",children:[e.role," • ",e.department]})]})]},e._id))})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Adhoc Team Members (",f.length,")",(0,s.jsx)("span",{className:"text-sm text-gray-500 ml-2",children:"• Different Departments"})]}),0===f.length?(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:"No available team members from different departments"}):(0,s.jsx)("div",{className:"max-h-60 overflow-y-auto border border-gray-300 rounded-md p-3",children:f.map(e=>(0,s.jsxs)("label",{className:"flex items-center space-x-3 py-2 cursor-pointer hover:bg-gray-50 rounded px-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:l.assignedTo.includes(e._id),onChange:()=>j(e._id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.email}),(0,s.jsxs)("div",{className:"text-xs text-gray-400",children:[e.role," • ",e.department]})]})]},e._id))})]})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 mt-8",children:[(0,s.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 cursor-pointer whitespace-nowrap",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",disabled:d,className:"px-4 py-2 bg-blue-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-blue-700 cursor-pointer whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Creating...":"Create Project"})]})]})]})})}function u(e){var t;let{project:r,onSave:l,onClose:n}=e,[i,o]=(0,a.useState)({title:r.title,description:r.description,status:r.status,priority:r.priority,startDate:r.startDate,dueDate:r.dueDate,assignedTo:(null==(t=r.assignedTo)?void 0:t.map(e=>e._id))||[]}),[d,c]=(0,a.useState)([]),[x,u]=(0,a.useState)(!1),[h,g]=(0,a.useState)(null),[p,b]=(0,a.useState)("");(0,a.useEffect)(()=>{j();let e=localStorage.getItem("currentUser");e&&g(JSON.parse(e))},[]);let j=async()=>{try{let e=await m.K.getAssignableUsers(),t=Array.isArray(e)?e:[];c(t)}catch(e){console.error("Failed to fetch users:",e)}},y=(e,t)=>{o(r=>({...r,[e]:t}))},f=e=>{o(t=>({...t,assignedTo:t.assignedTo.includes(e)?t.assignedTo.filter(t=>t!==e):[...t.assignedTo,e]}))},{sameDepartment:v,differentDepartment:N}=(()=>{if(!h)return{sameDepartment:[],differentDepartment:[]};let e=d.filter(e=>e.name.toLowerCase().includes(p.toLowerCase())||e.email.toLowerCase().includes(p.toLowerCase())||e.department.toLowerCase().includes(p.toLowerCase()));return{sameDepartment:e.filter(e=>e.department===h.department),differentDepartment:e.filter(e=>e.department!==h.department)}})();return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-7xl w-full max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Edit Project"}),(0,s.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 cursor-pointer",children:(0,s.jsx)("i",{className:"ri-close-line w-6 h-6"})})]})}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),u(!0);let t=i.assignedTo.map(e=>({user:e,role:"employee"})),s={...i,startDate:i.startDate,dueDate:i.dueDate,assignedTo:i.assignedTo,teamMembers:t};l(r._id,s),u(!1)},className:"p-6",children:[(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project Title"}),(0,s.jsx)("input",{type:"text",value:i.title,onChange:e=>y("title",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,s.jsx)("textarea",{value:i.description,onChange:e=>y("description",e.target.value),rows:4,maxLength:500,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",required:!0})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,s.jsxs)("select",{value:i.status,onChange:e=>y("status",e.target.value),className:"w-full px-3 py-2 pr-8 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,s.jsx)("option",{value:"Active",children:"Active"}),(0,s.jsx)("option",{value:"On Hold",children:"On Hold"}),(0,s.jsx)("option",{value:"Completed",children:"Completed"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),(0,s.jsxs)("select",{value:i.priority,onChange:e=>y("priority",e.target.value),className:"w-full px-3 py-2 pr-8 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,s.jsx)("option",{value:"Low",children:"Low"}),(0,s.jsx)("option",{value:"Medium",children:"Medium"}),(0,s.jsx)("option",{value:"High",children:"High"})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),(0,s.jsx)("input",{type:"date",value:i.startDate,onChange:e=>y("startDate",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Due Date"}),(0,s.jsx)("input",{type:"date",value:i.dueDate,onChange:e=>y("dueDate",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign Team Members"}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Current Project Team Members"}),0===i.assignedTo.length?(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:"No team members assigned to this project"}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:i.assignedTo.map(e=>{let t=d.find(t=>t._id===e);return t?(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:t.name}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:t.email}),(0,s.jsx)("div",{className:"text-xs text-gray-400",children:t.department})]}),(0,s.jsx)("button",{onClick:()=>f(e),disabled:x,className:"text-red-600 hover:text-red-800 text-sm font-medium disabled:opacity-50 p-1 hover:bg-red-50 rounded ml-2",title:"Remove team member",children:(0,s.jsx)("i",{className:"ri-close-line w-4 h-4"})})]},e):null})})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Team Members"}),(0,s.jsx)("input",{type:"text",value:p,onChange:e=>b(e.target.value),placeholder:"Search by name, email, or department...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["My Team Members (",v.length,")",(0,s.jsx)("span",{className:"text-sm text-gray-500 ml-2",children:"• Same Department"})]}),0===v.length?(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:"No available team members from your department"}):(0,s.jsx)("div",{className:"max-h-60 overflow-y-auto border border-gray-300 rounded-md p-3",children:v.map(e=>(0,s.jsxs)("label",{className:"flex items-center space-x-3 py-2 cursor-pointer hover:bg-gray-50 rounded px-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:i.assignedTo.includes(e._id),onChange:()=>f(e._id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.email}),(0,s.jsxs)("div",{className:"text-xs text-gray-400",children:[e.role," • ",e.department]})]})]},e._id))})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Adhoc Team Members (",N.length,")",(0,s.jsx)("span",{className:"text-sm text-gray-500 ml-2",children:"• Different Departments"})]}),0===N.length?(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:"No team members from different departments available"}):(0,s.jsx)("div",{className:"max-h-60 overflow-y-auto border border-gray-300 rounded-md p-3",children:N.map(e=>(0,s.jsxs)("label",{className:"flex items-center space-x-3 py-2 cursor-pointer hover:bg-gray-50 rounded px-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:i.assignedTo.includes(e._id),onChange:()=>f(e._id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.email}),(0,s.jsxs)("div",{className:"text-xs text-gray-400",children:[e.role," • ",e.department]})]})]},e._id))})]})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 mt-8",children:[(0,s.jsx)("button",{type:"button",onClick:n,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 cursor-pointer whitespace-nowrap",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",disabled:x,className:"px-4 py-2 bg-blue-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-blue-700 cursor-pointer whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Saving...":"Save Changes"})]})]})]})})}function h(e){let{projectId:t,currentTeamMembers:r,onTeamUpdate:l,onClose:n}=e,[i,o]=(0,a.useState)([]),[d,c]=(0,a.useState)([]),[x,u]=(0,a.useState)(!1),[h,g]=(0,a.useState)(""),[p,b]=(0,a.useState)(""),[j,y]=(0,a.useState)(""),[f,v]=(0,a.useState)(null),[N,w]=(0,a.useState)(r),[D,k]=(0,a.useState)(!1);(0,a.useEffect)(()=>{S();let e=localStorage.getItem("currentUser");e&&v(JSON.parse(e))},[]),(0,a.useEffect)(()=>{let e=r.map(e=>C(e)).sort(),t=N.map(e=>C(e)).sort();JSON.stringify(e)!==JSON.stringify(t)&&w(r)},[r,N]),(0,a.useEffect)(()=>{let e=localStorage.getItem("currentUser");e&&v(JSON.parse(e))},[]),(0,a.useEffect)(()=>{let e=d.filter(e=>!N.some(t=>C(t)===e));e.length!==d.length&&c(e)},[N,d]);let S=async()=>{try{let e=await m.K.getAssignableUsers(),t=Array.isArray(e)?e:[];o(t)}catch(e){console.error("Failed to fetch users:",e),g("Failed to load users")}},C=e=>e.user&&e.user._id?e.user._id:e._id?e._id:"",A=e=>e.user&&e.user.name?e.user.name:e.name?e.name:"Unknown User",T=e=>e.user&&e.user.email?e.user.email:e.email?e.email:"",M=e=>e.user&&e.user.department?e.user.department:e.department?e.department:"",P=e=>N.some(t=>C(t)===e),{sameDepartment:_,differentDepartment:L}=f?{sameDepartment:i.filter(e=>e.department===f.department),differentDepartment:i.filter(e=>e.department!==f.department)}:{sameDepartment:[],differentDepartment:[]},E=async()=>{if(0===d.length)return void g("Please select at least one user");if(!t||""===t.trim())return void g("Invalid project ID");u(!0),g("");try{let e=d.map(e=>({userId:e})),r=d.map(e=>{let t=i.find(t=>t._id===e);return{user:{_id:e,name:(null==t?void 0:t.name)||"Unknown User",email:(null==t?void 0:t.email)||"",role:(null==t?void 0:t.role)||"employee",department:(null==t?void 0:t.department)||""}}});w(e=>[...e,...r]);try{await m.K.bulkAddTeamMembers(t,e)}catch(r){try{for(let r of e)await m.K.addTeamMember(t,r.userId)}catch(e){await m.K.addTeamMembersViaProjectUpdate(t,d)}}c([]),b("Successfully added ".concat(d.length," team member").concat(1!==d.length?"s":"","!")),l(),setTimeout(()=>{n()},1500)}catch(e){console.error("Failed to add team members:",e),g("Failed to add team members: ".concat(e instanceof Error?e.message:"Unknown error")),w(r)}finally{u(!1)}},F=async e=>{if(confirm("Are you sure you want to remove this team member?")){u(!0),g("");try{if(!P(e))throw Error("User is not a team member");w(t=>t.filter(t=>C(t)!==e));try{await m.K.removeTeamMember(t,e)}catch(r){await m.K.removeTeamMemberViaProjectUpdate(t,e)}b("Team member removed successfully!"),l(),setTimeout(()=>{n()},1500)}catch(e){console.error("Failed to remove team member:",e),g("Failed to remove team member: ".concat(e instanceof Error?e.message:"Unknown error")),w(r)}finally{u(!1)}}},I=e=>{P(e)||c(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-7xl w-full max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Manage Team Members"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("button",{onClick:()=>{w(r)},className:"text-blue-600 hover:text-blue-800 cursor-pointer p-1",title:"Refresh team members",children:(0,s.jsx)("i",{className:"ri-refresh-line w-5 h-5"})}),(0,s.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 cursor-pointer",children:(0,s.jsx)("i",{className:"ri-close-line w-6 h-6"})})]})]})}),h&&(0,s.jsx)("div",{className:"mx-6 mt-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:h}),p&&(0,s.jsx)("div",{className:"mx-6 mt-4 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg text-sm",children:p}),(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Current Project Team Members"}),N.length>5&&(0,s.jsx)("button",{onClick:()=>k(!D),className:"flex items-center text-sm text-blue-600 hover:text-blue-800 font-medium",children:D?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("i",{className:"ri-arrow-up-s-line mr-1"}),"Show Less"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("i",{className:"ri-arrow-down-s-line mr-1"}),"Show All (",N.length,")"]})})]}),0===N.length?(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:"No team members assigned to this project"}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:(D?N:N.slice(0,5)).map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:A(e)}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:T(e)}),(0,s.jsx)("div",{className:"text-xs text-gray-400",children:M(e)})]}),(0,s.jsx)("button",{onClick:()=>F(C(e)),disabled:x,className:"text-red-600 hover:text-red-800 text-sm font-medium disabled:opacity-50 p-1 hover:bg-red-50 rounded ml-2",title:"Remove team member",children:(0,s.jsx)("i",{className:"ri-close-line w-4 h-4"})})]},C(e)))})]}),d.length>0&&(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selected Users to Add:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:d.map(e=>{let t=i.find(t=>t._id===e);return t?(0,s.jsxs)("div",{className:"flex items-center bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm",children:[(0,s.jsx)("span",{children:t.name}),(0,s.jsx)("button",{onClick:()=>I(e),className:"ml-2 text-blue-600 hover:text-blue-800",children:(0,s.jsx)("i",{className:"ri-close-line w-3 h-3"})})]},e):null})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["My Team Members (",_.length,")",(0,s.jsx)("span",{className:"text-sm text-gray-500 ml-2",children:"• Same Department"})]}),0===_.length?(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:"No available team members from your department"}):(0,s.jsx)("div",{className:"max-h-60 overflow-y-auto border border-gray-300 rounded-md p-3",children:_.map(e=>(0,s.jsxs)("label",{className:"flex items-center space-x-3 py-2 cursor-pointer hover:bg-gray-50 rounded px-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:d.includes(e._id)||P(e._id),onChange:()=>I(e._id),disabled:P(e._id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500 disabled:opacity-50"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[e.name,P(e._id)&&(0,s.jsx)("span",{className:"ml-2 text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:"Current Member"})]}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.email}),(0,s.jsxs)("div",{className:"text-xs text-gray-400",children:[e.role," • ",e.department]})]})]},e._id))})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Adhoc Team Members (",L.length,")",(0,s.jsx)("span",{className:"text-sm text-gray-500 ml-2",children:"• Different Department"})]}),0===L.length?(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:"No available team members from other departments"}):(0,s.jsx)("div",{className:"max-h-60 overflow-y-auto border border-gray-300 rounded-md p-3",children:L.map(e=>(0,s.jsxs)("label",{className:"flex items-center space-x-3 py-2 cursor-pointer hover:bg-gray-50 rounded px-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:d.includes(e._id)||P(e._id),onChange:()=>I(e._id),disabled:P(e._id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500 disabled:opacity-50"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[e.name,P(e._id)&&(0,s.jsx)("span",{className:"ml-2 text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:"Current Member"})]}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.email}),(0,s.jsxs)("div",{className:"text-xs text-gray-400",children:[e.role," • ",e.department]})]})]},e._id))})]})]}),d.length>0&&(0,s.jsx)("div",{className:"mt-6 flex justify-center",children:(0,s.jsx)("button",{onClick:E,disabled:x,className:"px-6 py-2 bg-blue-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Adding...":"Add ".concat(d.length," Member").concat(1!==d.length?"s":""," to Project")})})]})]})})}var g=r(5802),p=r(883),b=r(9509);function j(){let[e,t]=(0,a.useState)([]),[r,l]=(0,a.useState)(!1),[o,d]=(0,a.useState)(!1),[j,y]=(0,a.useState)(!1),[f,v]=(0,a.useState)(null),[N,w]=(0,a.useState)(null),[D,k]=(0,a.useState)(!0),[S,C]=(0,a.useState)(""),[A,T]=(0,a.useState)("All"),[M,P]=(0,a.useState)(""),[_,L]=(0,a.useState)([]),[E,F]=(0,a.useState)("All Projects"),[I,U]=(0,a.useState)("list"),[O,R]=(0,a.useState)("All Departments"),[K,H]=(0,a.useState)(null),[J,Y]=(0,a.useState)([]),[q,z]=(0,a.useState)([]);(0,a.useEffect)(()=>{let e=localStorage.getItem("currentUser");if(console.log("ProjectTracker - Raw user string from localStorage:",e),e)try{let t=JSON.parse(e);console.log("ProjectTracker - Parsed user data:",t),H(t),"admin"===t.role&&(t.department?R(t.department):R("All Departments"))}catch(e){console.error("ProjectTracker - Error parsing user data:",e),C("Invalid user data. Please log in again.")}else console.log("ProjectTracker - No user data found in localStorage")},[]);let W=async()=>{try{if((null==K?void 0:K.role)==="admin"){let e=await m.K.getDepartments();Y(e)}}catch(e){console.error("Error fetching departments:",e)}};(0,a.useEffect)(()=>{K&&(W(),B(),F("All Projects"))},[A,O,K]),(0,a.useEffect)(()=>{let e=async()=>{try{let e={};(null==K?void 0:K.role)==="admin"&&(e.department=O);let t=await m.K.getProjects(e),r=((Array.isArray(t)?t:t&&Array.isArray(t.projects)?t.projects:[])||[]).map(e=>({id:e._id||e.id,title:e.title}));L(r)}catch(e){}};K&&e()},[K,O]),(0,a.useEffect)(()=>{(async()=>{try{let e=await m.K.getTasks();z(Array.isArray(e)?e:[])}catch(e){console.error("Failed to load tasks for gantt:",e),z([])}})()},[]);let B=async()=>{k(!0);try{if(console.log("Fetching projects..."),console.log("Current user:",K),console.log("Status filter:",A),console.log("Department filter:",O),!K||!K._id||!K.role||!K.department){console.error("Current user missing required fields:",K),C("User information is incomplete. Please log in again."),t([]);return}let e={status:"All"!==A?A:void 0};(null==K?void 0:K.role)==="admin"&&(e.department=O),console.log("API params:",e);let r=await m.K.getProjects(e);console.log("Projects API response:",r),r&&r.projects&&Array.isArray(r.projects)?(t(r.projects),console.log("Projects set from paginated response:",r.projects)):Array.isArray(r)?(t(r),console.log("Projects set from array response:",r)):(console.error("Unexpected projects response format:",r),t([]))}catch(r){console.error("Failed to fetch projects:",r);let e="Failed to load projects";r instanceof Error&&(e=r.message.includes("500")?"Server error: Please check if you have proper permissions to view projects":r.message.includes("401")?"Authentication error: Please log in again":r.message.includes("403")?"Access denied: You do not have permission to view these projects":"Failed to load projects: ".concat(r.message)),C(e),t([])}k(!1)},G=(0,a.useMemo)(()=>{let t=Array.isArray(e)?e.filter(e=>null!=e):[];console.log("visibleProjects - projects array:",t);let r=t;if(E&&"All Projects"!==E&&(r=r.filter(e=>e&&(e._id||e.id)===E)),!M)return r;let s=M.toLowerCase(),a=r.filter(e=>e&&[e.title,e.description].some(e=>null==e?void 0:e.toLowerCase().includes(s)));return console.log("visibleProjects - filtered:",a),a},[e,M,E]),V=async e=>{try{console.log("Creating project with data:",e),console.log("API Base URL:",b.env.NEXT_PUBLIC_API_URL||"http://localhost:5000"),console.log("Auth token:",localStorage.getItem("token"));let t=await m.K.createProject(e);console.log("Project created successfully:",t),await B(),l(!1)}catch(e){console.error("Failed to add project:",e),C("Failed to add project: ".concat(e instanceof Error?e.message:"Unknown error"))}},Z=e=>{v(e),d(!0)},X=async(e,t)=>{try{await m.K.updateProject(e,t),await B(),d(!1),v(null)}catch(e){console.error("Failed to update project:",e),C("Failed to update project")}},Q=async e=>{if(e&&confirm("Are you sure you want to delete this project?"))try{await m.K.deleteProject(e),await B()}catch(e){console.error("Failed to delete project:",e),C("Failed to delete project")}},$=()=>{l(!1),d(!1),y(!1),v(null),w(null)},ee=e=>{w(e),y(!0)},et=async()=>{try{await new Promise(e=>setTimeout(e,300)),await B(),await er()}catch(e){console.error("Failed to update team data:",e)}},er=async()=>{if(N)try{let e=await m.K.getProjectById(N._id);e&&w(e)}catch(e){console.error("Failed to refresh team management data:",e)}},es=e=>{if(!e)return"bg-gray-100 text-gray-800";switch(e){case"High":return"bg-red-100 text-red-800";case"Medium":return"bg-yellow-100 text-yellow-800";case"Low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},ea=e=>!!K&&("admin"===K.role||"manager"===K.role&&e.department===K.department),el=e=>!!K&&("admin"===K.role||"manager"===K.role&&e.department===K.department);return K&&K._id&&K.role&&K.department?(0,s.jsx)(g.A,{children:(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)(i.A,{}),(0,s.jsx)("div",{className:"px-6 py-8",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-8 flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Project Tracker"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Manage and track all your projects"}),K&&(0,s.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Role: ",K.role," • Department: ",K.department]})]}),!!K&&("admin"===K.role||"manager"===K.role)&&(0,s.jsxs)("button",{onClick:()=>l(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium cursor-pointer whitespace-nowrap flex items-center space-x-2",children:[(0,s.jsx)("i",{className:"ri-add-line w-5 h-5"}),(0,s.jsx)("span",{children:"Add New Project"})]})]}),S&&(0,s.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:S}),(0,s.jsx)("button",{onClick:()=>{C(""),B()},className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Retry"})]})}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:(0,s.jsxs)("div",{className:"p-6 grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,s.jsx)("select",{value:A,onChange:e=>T(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",children:["All","Active","Completed","On Hold"].map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(null==K?void 0:K.role)==="admin"&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),(0,s.jsxs)("select",{value:O,onChange:e=>R(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",children:[(0,s.jsx)("option",{value:"All Departments",children:"All Departments"}),(J.length>0?J:p.uy).map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),(0,s.jsx)("input",{type:"text",value:M,onChange:e=>P(e.target.value),placeholder:"Search by title or description...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project"}),(0,s.jsxs)("select",{value:E,onChange:e=>F(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",children:[(0,s.jsx)("option",{value:"All Projects",children:"All Projects"}),_.map(e=>(0,s.jsx)("option",{value:e.id,children:e.title},e.id))]})]})]})}),(0,s.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,s.jsx)("div",{className:"flex space-x-2 bg-gray-100 rounded-full p-1",children:["gantt","list"].map(e=>(0,s.jsx)("button",{onClick:()=>U(e),className:"px-4 py-2 rounded-full text-sm font-medium ".concat(I===e?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"gantt"===e?"Gantt View":"List View"},e))})}),"gantt"===I?(0,s.jsx)(c,{projects:G,tasks:q}):(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,s.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"All Projects"})}),(0,s.jsx)("div",{className:"p-6",children:D||!K?(0,s.jsx)("p",{children:K?"Loading projects...":"Loading user information..."}):(0,s.jsxs)("div",{className:"space-y-4",children:[Array.isArray(G)&&G.map(e=>(0,s.jsx)("div",{className:"border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(n(),{href:"/project-tracker/".concat(null==e?void 0:e._id),className:"flex-1 cursor-pointer",children:(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:null==e?void 0:e.title}),(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(es(null==e?void 0:e.priority)),children:null==e?void 0:e.priority})]}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:null==e?void 0:e.description}),(0,s.jsxs)("div",{className:"flex items-center space-x-6 text-sm text-gray-500",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("i",{className:"ri-calendar-line w-4 h-4 mr-2"}),(0,s.jsxs)("span",{children:["Start: ",new Date(null==e?void 0:e.startDate).toLocaleDateString()]})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("i",{className:"ri-flag-line w-4 h-4 mr-2"}),(0,s.jsxs)("span",{children:["Due: ",new Date(null==e?void 0:e.dueDate).toLocaleDateString()]})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("i",{className:"ri-building-line w-4 h-4 mr-2"}),(0,s.jsx)("span",{children:(null==e?void 0:e.department)||"No Department"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("i",{className:"ri-team-line w-4 h-4 mr-2"}),(0,s.jsxs)("span",{children:[(null==e?void 0:e.activeMembersCount)||0," active members"]})]})]})]})}),(0,s.jsxs)("div",{className:"flex items-center space-x-4 ml-6",children:[(0,s.jsx)("span",{className:"px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap ".concat((null==e?void 0:e.status)==="Active"?"bg-green-100 text-green-800":(null==e?void 0:e.status)==="Completed"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"),children:null==e?void 0:e.status}),ea(e)&&(0,s.jsx)("button",{onClick:t=>{t.preventDefault(),Z(e)},className:"text-gray-600 hover:text-gray-800 cursor-pointer",title:"Edit Project",children:(0,s.jsx)("i",{className:"ri-edit-line w-5 h-5"})}),ea(e)&&(0,s.jsx)("button",{onClick:t=>{t.preventDefault(),ee(e)},className:"text-blue-600 hover:text-blue-800 cursor-pointer",title:"Manage Team",children:(0,s.jsx)("i",{className:"ri-team-line w-5 h-5"})}),el(e)&&(0,s.jsx)("button",{onClick:t=>{t.preventDefault(),e._id&&Q(e._id)},className:"text-red-600 hover:text-red-800 cursor-pointer",title:"Delete Project",children:(0,s.jsx)("i",{className:"ri-delete-bin-line w-5 h-5"})}),(0,s.jsx)(n(),{href:"/project-tracker/".concat(null==e?void 0:e._id),children:(0,s.jsx)("i",{className:"ri-arrow-right-line w-5 h-5 text-gray-400"})})]})]})},(null==e?void 0:e._id)||(null==e?void 0:e.id)||Math.random())),(!Array.isArray(G)||0===G.length)&&!D&&(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:Array.isArray(G)?"No projects found with current filters.":"Error loading projects"})]})})]})]})}),r&&(0,s.jsx)(x,{onSave:V,onClose:$}),o&&f&&(0,s.jsx)(u,{project:f,onSave:X,onClose:$}),j&&N&&(0,s.jsx)(h,{projectId:N._id,currentTeamMembers:N.teamMembers||[],onTeamUpdate:et,onClose:()=>{y(!1),w(null)}},"team-management-".concat(N._id,"-").concat(JSON.stringify(N.teamMembers)))]})}):(0,s.jsx)(g.A,{children:(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)(i.A,{}),(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading user information..."}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Please wait while we verify your permissions"})]})})]})})}},7288:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var s=r(5155),a=r(6874),l=r.n(a),n=r(5695),i=r(2115);function o(){let e=(0,n.usePathname)(),t=(0,n.useRouter)(),[r,a]=(0,i.useState)(null);return(0,i.useEffect)(()=>{let e=localStorage.getItem("currentUser");e&&a(JSON.parse(e))},[]),(0,s.jsx)("header",{className:"bg-gradient-to-r from-blue-600 to-purple-600 shadow-lg border-b border-blue-500",children:(0,s.jsx)("div",{className:"px-6 py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)("h1",{className:"text-2xl font-bold text-white tracking-wide",children:"Project Tracker"})}),(0,s.jsx)("nav",{className:"flex items-center space-x-2",children:[{name:"Dashboard",path:"/project-tracker/dashboard"},{name:"Project Tracker",path:"/project-tracker"},{name:"Task Tracker",path:"/task-tracker"}].map(t=>{var r;let a="/project-tracker/dashboard"===(r=t.path)?"/project-tracker/dashboard"===e||e.startsWith("/project-tracker/dashboard/"):"/project-tracker"===r?"/project-tracker"===e||e.startsWith("/project-tracker/")&&!e.startsWith("/project-tracker/dashboard"):e===r||e.startsWith(r+"/");return(0,s.jsx)(l(),{href:t.path,className:"px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap cursor-pointer transition-all duration-200 ".concat(a?"bg-white text-blue-600 shadow-md transform scale-105":"text-blue-100 hover:text-white hover:bg-white/20 hover:shadow-md"),children:t.name},t.path)})}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)(l(),{href:"/",className:"px-4 py-2 rounded-lg text-sm font-medium text-blue-100 hover:text-white hover:bg-white/20 transition-all duration-200 whitespace-nowrap",children:[(0,s.jsx)("i",{className:"ri-arrow-left-line mr-2"}),"Back to Portal"]}),r&&(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"text-sm text-blue-100 hidden sm:block",children:(0,s.jsx)("span",{className:"font-semibold",children:r.name})}),(0,s.jsxs)("button",{onClick:()=>{localStorage.removeItem("currentUser"),localStorage.removeItem("token"),t.push("/login")},className:"flex items-center px-4 py-2 bg-red-500 hover:bg-red-600 text-white text-sm font-medium rounded-lg transition-all duration-200 hover:shadow-lg transform hover:scale-105 cursor-pointer whitespace-nowrap",children:[(0,s.jsx)("i",{className:"ri-logout-box-line mr-2"}),"Logout"]})]})]})]})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[244,296,441,684,358],()=>t(3771)),_N_E=e.O()}]);