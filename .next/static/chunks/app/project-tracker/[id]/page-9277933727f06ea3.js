(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[241],{3916:(e,t,s)=>{Promise.resolve().then(s.bind(s,4311))},4311:(e,t,s)=>{"use strict";s.d(t,{default:()=>x});var a=s(5155),r=s(2115),l=s(6874),o=s.n(l),n=s(7288),c=s(9265),i=s(5731),d=s(7296);function x(e){let{projectId:t}=e,[s,l]=(0,r.useState)(null),[x,p]=(0,r.useState)([]),[m,g]=(0,r.useState)(!0),[u,h]=(0,r.useState)(""),[y,j]=(0,r.useState)(!1),[f,w]=(0,r.useState)(!1),[N,k]=(0,r.useState)(null),[b,v]=(0,r.useState)(null);console.log("ProjectDetail component rendered with projectId:",t),(0,r.useEffect)(()=>{console.log("ProjectDetail useEffect triggered with projectId:",t);let e=localStorage.getItem("token"),s=localStorage.getItem("currentUser");if(console.log("Authentication check - Token exists:",!!e),console.log("Authentication check - User exists:",!!s),s)try{let e=JSON.parse(s);console.log("Current user data:",e),console.log("User role:",e.role),console.log("User ID:",e._id),console.log("User department:",e.department),v(e)}catch(e){console.error("Error parsing user data:",e)}t?D():(h("No project ID provided"),g(!1))},[t]);let D=async()=>{g(!0),h("");try{if(console.log("Fetching project data for ID:",t),console.log("Project ID type:",typeof t),console.log("Project ID length:",t.length),!t||""===t.trim())throw Error("Invalid project ID");let e=await d.K.getProjectById(t);if(console.log("Project API response:",e),e&&e.project)l(e.project),p(e.tasks||[]),console.log("Project set successfully:",e.project),console.log("Tasks set successfully:",e.tasks),console.log("Number of tasks:",e.tasks?e.tasks.length:0);else if(e&&e._id){l(e),console.log("Project set directly (legacy format):",e);try{let e=await d.K.getProjectTasks(t);p(Array.isArray(e)?e:[]),console.log("Tasks fetched separately:",e)}catch(e){console.log("Could not fetch tasks separately:",e),p([])}}else throw Error("Invalid project response format")}catch(e){console.error("Failed to fetch project data:",e),h("Project not found or failed to load project data")}g(!1)},T=e=>{console.log("Edit task clicked:",e),k(e),w(!0)},S=e=>!!b&&("admin"===b.role||"manager"===b.role||"employee"===b.role&&(e.assignedTo._id===b._id||e.reporter._id===b._id)),I=e=>!!b&&("admin"===b.role||"manager"===b.role||(b.role,!1)),P=async e=>{if(!e)return void console.error("No task ID provided for deletion");if(confirm("Are you sure you want to delete this task?"))try{console.log("Deleting task with ID:",e),await d.K.deleteTask(e),console.log("Task deleted successfully"),await D()}catch(e){console.error("Failed to delete task:",e),h("Failed to delete task")}};return m?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(n.A,{}),(0,a.jsx)("div",{className:"px-6 py-8",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsx)("p",{className:"text-center text-gray-600",children:"Loading project..."})})})]}):s?(console.log("Rendering project detail with project:",s),console.log("Rendering project detail with tasks:",x),console.log("Tasks length:",x.length),console.log("Current user state:",b),console.log("Can create task:",!!b),x.forEach((e,t)=>{console.log("Task ".concat(t,":"),{taskId:e._id,taskName:e.task,assignedTo:e.assignedTo,reporter:e.reporter,canEdit:S(e),canDelete:I(e)})}),(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(n.A,{}),(0,a.jsx)("div",{className:"px-6 py-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)(o(),{href:"/project-tracker",className:"text-blue-600 hover:text-blue-800 text-sm font-medium cursor-pointer",children:"← Back to Projects"}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mt-4 mb-2",children:s.title}),(0,a.jsx)("p",{className:"text-gray-600",children:s.description}),b&&(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Role: ",b.role," • Department: ",b.department]})]}),u&&(0,a.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:u}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Status"}),(0,a.jsx)("span",{className:"inline-block mt-1 px-3 py-1 rounded-full text-sm font-medium ".concat("Active"===s.status?"bg-green-100 text-green-800":"Completed"===s.status?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"),children:s.status})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Priority"}),(0,a.jsx)("span",{className:"inline-block mt-1 px-3 py-1 rounded-full text-sm font-medium ".concat("High"===s.priority?"bg-red-100 text-red-800":"Medium"===s.priority?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:s.priority})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Start Date"}),(0,a.jsx)("p",{className:"mt-1 text-gray-900",children:new Date(s.startDate).toLocaleDateString()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Due Date"}),(0,a.jsx)("p",{className:"mt-1 text-gray-900",children:new Date(s.dueDate).toLocaleDateString()})]})]})})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Project Tasks"}),!!b&&(0,a.jsxs)("button",{onClick:()=>j(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 cursor-pointer whitespace-nowrap flex items-center",children:[(0,a.jsx)("i",{className:"ri-add-line w-4 h-4 mr-2"}),"Add New Task"]})]})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Task ID"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Task"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Priority"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assigned To"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reporter"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Start Date"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"End Date"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Hours"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sprint"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsxs)("tbody",{className:"bg-white divide-y divide-gray-200",children:[x.map(e=>{var t,s;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.id}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.task}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900 max-w-xs truncate",children:e.description}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("Daily"===e.taskType?"bg-blue-100 text-blue-800":"Weekly"===e.taskType?"bg-purple-100 text-purple-800":"Monthly"===e.taskType?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.taskType})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("Completed"===e.status?"bg-green-100 text-green-800":"In Progress"===e.status?"bg-yellow-100 text-yellow-800":"Blocked"===e.status?"bg-red-100 text-red-800":"On Hold"===e.status?"bg-orange-100 text-orange-800":"Cancelled"===e.status?"bg-gray-200 text-gray-800":"bg-gray-100 text-gray-800"),children:e.status})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("Critical"===e.priority?"bg-red-100 text-red-800":"High"===e.priority?"bg-orange-100 text-orange-800":"Medium"===e.priority?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.priority})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(null==(t=e.assignedTo)?void 0:t.name)||"Unassigned"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(null==(s=e.reporter)?void 0:s.name)||"Unknown"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.startDate?new Date(e.startDate).toLocaleDateString():"Not set"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(e.eta).toLocaleDateString()}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.actualHours||0,"/",e.estimatedHours||0]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.sprint||"Not set"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,a.jsxs)("div",{className:"flex space-x-3",children:[S(e)&&(0,a.jsxs)("button",{onClick:()=>T(e),className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200 shadow-sm",title:"Edit Task",children:[(0,a.jsx)("i",{className:"ri-edit-line w-3 h-3 mr-1"}),"Edit"]}),I(e)&&(0,a.jsxs)("button",{onClick:()=>P(e._id),className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200 shadow-sm",title:"Delete Task",children:[(0,a.jsx)("i",{className:"ri-delete-bin-line w-3 h-3 mr-1"}),"Delete"]})]})})]},e._id)}),0===x.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:13,className:"px-6 py-8 text-center text-gray-500",children:"No tasks found for this project."})})]})]})})]})]})}),y&&(0,a.jsx)(c.A,{projectId:t,onAdd:e=>{console.log("New task added:",e),j(!1),D()},onClose:()=>j(!1)}),f&&N&&(0,a.jsx)(i.A,{task:N,onSave:e=>{(async()=>{try{console.log("Saving updated task:",e);let t={task:e.task,description:e.description,taskType:e.taskType,status:e.status,priority:e.priority,assignedTo:e.assignedTo._id,reporter:e.reporter._id,startDate:e.startDate,eta:e.eta,estimatedHours:e.estimatedHours,actualHours:e.actualHours,remark:e.remark,roadBlock:e.roadBlock,supportNeeded:e.supportNeeded,labels:e.labels,attachments:e.attachments,relatedTasks:e.relatedTasks,parentTask:e.parentTask,sprint:e.sprint};console.log("Task data for API:",t),await d.K.updateTask(e._id,t),console.log("Task updated successfully"),w(!1),k(null),await D()}catch(e){console.error("Failed to update task:",e),h("Failed to update task")}})()},onClose:()=>w(!1)})]})):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(n.A,{}),(0,a.jsx)("div",{className:"px-6 py-8",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsx)("p",{className:"text-center text-gray-600",children:"Project not found"})})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[244,296,990,441,684,358],()=>t(3916)),_N_E=e.O()}]);